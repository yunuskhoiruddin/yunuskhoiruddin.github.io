const listCategories = {
    'web-dev': 'Web Developer',
    'web-pro': 'Web Programmer',
    'wp-dev': 'Wordpress Developer',
    'other': 'Other'
}
async function load( output ) {
    try {
        response = await fetch('/assets/database.json', {
            method: 'GET',
            headers: {'Content-Type': 'application/json'}
        })
        body = await response.json()
        return output(body)
    } catch (error) {
        console.error(error)
        return []
    }
}
document.addEventListener('DOMContentLoaded', async () => {
    await load( db => {
        const database = db
        const routes = [
            {
                name: 'home',
                path: '/',
                component: {
                    data() { return {
                        items: [],
                        categories: listCategories,
                        skills: {},
                        loaded: false
                    } },
                    async created() {
                        Object.keys(this.categories).forEach(item => this.items[item] = [])
                        this.skills = database.skills
                        this.items = database.experience
                        this.loaded = true
                    },
                    mounted() {},
                    methods: {
                        filterCategory(items, key) {
                            return items.filter(item => item.category == key)
                        }
                    },
                    template: '#home'
                }
            },
            {
                name: 'detail',
                path: '/project/:slug',
                component: {
                    data() { return {
                        slug: this.$route.params.slug,
                        item: {}
                    } },
                    created() {
                        this.item = database.experience.find( item => item.slug == this.slug )
                        if(!this.item) router.push({ path: '/', replace: true })
                    },
                    template: '#detail'
                }
            },
            {
                name: 'not-found',
                path: '/:pathMatch(.*)*',
                redirect: "/",
            }
        ];
        const router = VueRouter.createRouter({
            history: VueRouter.createWebHistory(),
            routes,
            scrollBehavior (to, from, savedPosition) {
                return { top: 0 }
            }
        })
        const app = Vue.createApp({
            data() { return {
                databse: {}
            } },
            methods: {
            },
            async mounted() {
                try {
                    response = await fetch('/assets/database.json', {
                        method: 'GET',
                        headers: {'Content-Type': 'application/json'}
                    })
                    body = await response.json()
                    this.database = body
                } catch (error) {
                    console.error(error)
                    this.database = {}
                }
            },
            template: '#app-vew'
        })
        app.use(router)
        app.mount('#app')
    })
})